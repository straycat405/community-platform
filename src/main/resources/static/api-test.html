<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Community Platform API í…ŒìŠ¤íŠ¸</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        h1, h2 {
            color: #333;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input, textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        button {
            background-color: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        button:hover {
            background-color: #0056b3;
        }
        .result {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            margin-top: 15px;
            white-space: pre-wrap;
            font-family: monospace;
            max-height: 300px;
            overflow-y: auto;
        }
        .status {
            font-weight: bold;
            margin-bottom: 10px;
        }
        .success { color: #28a745; }
        .error { color: #dc3545; }
    </style>
</head>
<body>
<h1>ğŸš€ Community Platform API í…ŒìŠ¤íŠ¸</h1>

<!-- ì„œë²„ ìƒíƒœ í™•ì¸ -->
<div class="container">
    <h2>ğŸ“¡ ì„œë²„ ìƒíƒœ í™•ì¸</h2>
    <p>ë¨¼ì € Spring Boot ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì‹¤í–‰ë˜ê³  ìˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.</p>
    <button onclick="checkServerStatus()">ì„œë²„ ìƒíƒœ í™•ì¸</button>
    <div id="serverResult" class="result" style="display: none;"></div>
</div>

<!-- íšŒì›ê°€ì… í…ŒìŠ¤íŠ¸ -->
<div class="container">
    <h2>ğŸ“ íšŒì›ê°€ì… í…ŒìŠ¤íŠ¸</h2>
    <form id="registerForm">
        <div class="form-group">
            <label>ì´ë©”ì¼:</label>
            <input type="email" id="registerEmail" value="test@example.com" required>
        </div>
        <div class="form-group">
            <label>ë‹‰ë„¤ì„:</label>
            <input type="text" id="registerNickname" value="testuser" required>
        </div>
        <div class="form-group">
            <label>ë¹„ë°€ë²ˆí˜¸:</label>
            <input type="password" id="registerPassword" value="password123" required>
        </div>
        <div class="form-group">
            <label>ë¹„ë°€ë²ˆí˜¸ í™•ì¸:</label>
            <input type="password" id="confirmPassword" value="password123" required>
        </div>
        <div class="form-group">
            <label>ìê¸°ì†Œê°œ (ì„ íƒ):</label>
            <textarea id="registerBio" placeholder="ê°„ë‹¨í•œ ìê¸°ì†Œê°œë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”"></textarea>
        </div>
        <div class="form-group">
            <label>GitHub URL (ì„ íƒ):</label>
            <input type="url" id="registerGithub" placeholder="https://github.com/username">
        </div>
        <button type="submit">íšŒì›ê°€ì…</button>
    </form>
    <div id="registerResult" class="result" style="display: none;"></div>
</div>

<!-- ì´ë©”ì¼ ì¤‘ë³µ í™•ì¸ -->
<div class="container">
    <h2>âœ‰ï¸ ì´ë©”ì¼ ì¤‘ë³µ í™•ì¸</h2>
    <div class="form-group">
        <label>ì´ë©”ì¼:</label>
        <input type="email" id="checkEmail" value="test@example.com">
    </div>
    <button onclick="checkEmailDuplicate()">ì´ë©”ì¼ ì¤‘ë³µ í™•ì¸</button>
    <div id="emailCheckResult" class="result" style="display: none;"></div>
</div>

<!-- ë‹‰ë„¤ì„ ì¤‘ë³µ í™•ì¸ -->
<div class="container">
    <h2>ğŸ‘¤ ë‹‰ë„¤ì„ ì¤‘ë³µ í™•ì¸</h2>
    <div class="form-group">
        <label>ë‹‰ë„¤ì„:</label>
        <input type="text" id="checkNickname" value="testuser">
    </div>
    <button onclick="checkNicknameDuplicate()">ë‹‰ë„¤ì„ ì¤‘ë³µ í™•ì¸</button>
    <div id="nicknameCheckResult" class="result" style="display: none;"></div>
</div>

<!-- ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸ -->
<div class="container">
    <h2>ğŸ” ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸</h2>
    <form id="loginForm">
        <div class="form-group">
            <label>ì´ë©”ì¼:</label>
            <input type="email" id="loginEmail" value="test@example.com" required>
        </div>
        <div class="form-group">
            <label>ë¹„ë°€ë²ˆí˜¸:</label>
            <input type="password" id="loginPassword" value="password123" required>
        </div>
        <button type="submit">ë¡œê·¸ì¸</button>
    </form>
    <div id="loginResult" class="result" style="display: none;"></div>
</div>

<!-- ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ -->
<div class="container">
    <h2>ğŸ‘¥ ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ</h2>
    <div class="form-group">
        <label>ì‚¬ìš©ì ID:</label>
        <input type="number" id="userId" value="1" min="1">
    </div>
    <button onclick="getUserById()">IDë¡œ ì¡°íšŒ</button>

    <div class="form-group" style="margin-top: 15px;">
        <label>ì´ë©”ì¼:</label>
        <input type="email" id="userEmail" value="test@example.com">
    </div>
    <button onclick="getUserByEmail()">ì´ë©”ì¼ë¡œ ì¡°íšŒ</button>
    <div id="userInfoResult" class="result" style="display: none;"></div>
</div>

<!-- H2 ì½˜ì†” ë§í¬ -->
<div class="container">
    <h2>ğŸ—„ï¸ H2 ë°ì´í„°ë² ì´ìŠ¤ ì½˜ì†”</h2>
    <p>ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì§ì ‘ í™•ì¸í•˜ë ¤ë©´ H2 ì½˜ì†”ì„ ì‚¬ìš©í•˜ì„¸ìš”.</p>
    <button onclick="openH2Console()">H2 ì½˜ì†” ì—´ê¸°</button>
    <div style="margin-top: 10px; font-size: 14px; color: #666;">
        <strong>ì—°ê²° ì •ë³´:</strong><br>
        JDBC URL: jdbc:h2:mem:testdb<br>
        User Name: sa<br>
        Password: (ë¹„ì–´ìˆìŒ)
    </div>
</div>

<script>
    const API_BASE_URL = 'http://localhost:8080/api';

    // ì„œë²„ ìƒíƒœ í™•ì¸
    async function checkServerStatus() {
        const resultDiv = document.getElementById('serverResult');
        resultDiv.style.display = 'block';

        // ì—¬ëŸ¬ ë°©ë²•ìœ¼ë¡œ ì„œë²„ ìƒíƒœ í™•ì¸
        const healthEndpoints = [
            { url: `${API_BASE_URL}/health`, name: 'Health Check API' },
            { url: `${API_BASE_URL}/health/ping`, name: 'Ping API' },
            { url: `http://localhost:8080/actuator/health`, name: 'Spring Actuator' }
        ];

        for (const endpoint of healthEndpoints) {
            try {
                const response = await fetch(endpoint.url);
                if (response.ok) {
                    const data = await response.json();
                    resultDiv.innerHTML = `<div class="status success">âœ… ì„œë²„ê°€ ì •ìƒì ìœ¼ë¡œ ì‹¤í–‰ ì¤‘ì…ë‹ˆë‹¤!</div>
                    <strong>í™•ì¸ëœ ì—”ë“œí¬ì¸íŠ¸:</strong> ${endpoint.name}
                    <strong>ì‘ë‹µ ë°ì´í„°:</strong>
                    ${JSON.stringify(data, null, 2)}`;
                    return; // ì„±ê³µí•˜ë©´ ì¦‰ì‹œ ì¢…ë£Œ
                }
            } catch (error) {
                // ë‹¤ìŒ ì—”ë“œí¬ì¸íŠ¸ ì‹œë„
                continue;
            }
        }

        // ëª¨ë“  ì—”ë“œí¬ì¸íŠ¸ ì‹¤íŒ¨ì‹œ
        resultDiv.innerHTML = `<div class="status error">âŒ ì„œë²„ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>
        <strong>í™•ì¸ì‚¬í•­:</strong>
        1. Spring Boot ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì‹¤í–‰ë˜ê³  ìˆëŠ”ì§€ í™•ì¸
        2. í¬íŠ¸ 8080ì´ ì‚¬ìš© ì¤‘ì¸ì§€ í™•ì¸
        3. CORS ì„¤ì •ì´ ì˜¬ë°”ë¥¸ì§€ í™•ì¸
        4. HealthCheckControllerê°€ êµ¬í˜„ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸

        <strong>ì‹œë„í•œ ì—”ë“œí¬ì¸íŠ¸ë“¤:</strong>
        ${healthEndpoints.map(ep => `- ${ep.url} (${ep.name})`).join('\n')}`;
    }

    // íšŒì›ê°€ì…
    document.getElementById('registerForm').addEventListener('submit', async function(e) {
        e.preventDefault();

        const data = {
            email: document.getElementById('registerEmail').value,
            nickname: document.getElementById('registerNickname').value,
            password: document.getElementById('registerPassword').value,
            confirmPassword: document.getElementById('confirmPassword').value,
            bio: document.getElementById('registerBio').value,
            githubUrl: document.getElementById('registerGithub').value
        };

        await makeApiCall('POST', '/users/register', data, 'registerResult');
    });

    // ë¡œê·¸ì¸
    document.getElementById('loginForm').addEventListener('submit', async function(e) {
        e.preventDefault();

        const data = {
            email: document.getElementById('loginEmail').value,
            password: document.getElementById('loginPassword').value
        };

        await makeApiCall('POST', '/users/login', data, 'loginResult');
    });

    // ì´ë©”ì¼ ì¤‘ë³µ í™•ì¸
    async function checkEmailDuplicate() {
        const email = document.getElementById('checkEmail').value;
        await makeApiCall('GET', `/users/check-email?email=${encodeURIComponent(email)}`, null, 'emailCheckResult');
    }

    // ë‹‰ë„¤ì„ ì¤‘ë³µ í™•ì¸
    async function checkNicknameDuplicate() {
        const nickname = document.getElementById('checkNickname').value;
        await makeApiCall('GET', `/users/check-nickname?nickname=${encodeURIComponent(nickname)}`, null, 'nicknameCheckResult');
    }

    // IDë¡œ ì‚¬ìš©ì ì¡°íšŒ
    async function getUserById() {
        const userId = document.getElementById('userId').value;
        await makeApiCall('GET', `/users/${userId}`, null, 'userInfoResult');
    }

    // ì´ë©”ì¼ë¡œ ì‚¬ìš©ì ì¡°íšŒ
    async function getUserByEmail() {
        const email = document.getElementById('userEmail').value;
        await makeApiCall('GET', `/users/by-email?email=${encodeURIComponent(email)}`, null, 'userInfoResult');
    }

    // ê³µí†µ API í˜¸ì¶œ í•¨ìˆ˜
    async function makeApiCall(method, endpoint, data, resultElementId) {
        const resultDiv = document.getElementById(resultElementId);
        resultDiv.style.display = 'block';
        resultDiv.innerHTML = '<div class="status">â³ ìš”ì²­ ì¤‘...</div>';

        try {
            const options = {
                method: method,
                headers: {
                    'Content-Type': 'application/json',
                }
            };

            if (data && method !== 'GET') {
                options.body = JSON.stringify(data);
            }

            const response = await fetch(API_BASE_URL + endpoint, options);
            const responseData = await response.text();

            let parsedData;
            try {
                parsedData = JSON.parse(responseData);
            } catch {
                parsedData = responseData;
            }

            if (response.ok) {
                resultDiv.innerHTML = `<div class="status success">âœ… ì„±ê³µ (${response.status})</div>` +
                                    JSON.stringify(parsedData, null, 2);
            } else {
                resultDiv.innerHTML = `<div class="status error">âŒ ì‹¤íŒ¨ (${response.status})</div>` +
                                    JSON.stringify(parsedData, null, 2);
            }
        } catch (error) {
            resultDiv.innerHTML = `<div class="status error">âŒ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜</div>` +
                                `ì˜¤ë¥˜: ${error.message}`;
        }
    }

    // H2 ì½˜ì†” ì—´ê¸°
    function openH2Console() {
        window.open('http://localhost:8080/h2-console', '_blank');
    }

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì„œë²„ ìƒíƒœ ìë™ í™•ì¸
    window.addEventListener('load', function() {
        setTimeout(checkServerStatus, 1000);
    });
</script>
</body>
</html>